<h1 id="xterm">xterm<a aria-hidden="true" class="anchor-heading icon-link" href="#xterm"></a></h1>
<h2 id="xterm-踩雷經驗">xterm 踩雷經驗<a aria-hidden="true" class="anchor-heading icon-link" href="#xterm-踩雷經驗"></a></h2>
<h3 id="在使用-xterm-的時候遇到一些問題這邊做一些紀錄">在使用 xterm 的時候，遇到一些問題，這邊做一些紀錄<a aria-hidden="true" class="anchor-heading icon-link" href="#在使用-xterm-的時候遇到一些問題這邊做一些紀錄"></a></h3>
<ul>
<li><strong>當使用 attachCustomKeyEventHandler 時，<em>絕對</em> 要 return true/false</strong></li>
</ul>
<p>  會註冊成 <code>_customKeyEventHandler</code>，並在 <code>_keyDown, _keyUp, _keyPress</code> 中被呼叫，<br>
並以 <code>if (this._customKeyEventHandler(ev))</code> 來判斷是否要繼續處理 key event</p>
<p><a href="https://github.com/xtermjs/xterm.js/blob/6e351dd4ac23235c587dbf4af4cac737965cb7cd/src/browser/Terminal.ts#L1102">CodeLink</a></p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">protected</span> <span class="token function">_keyPress</span><span class="token punctuation">(</span>ev<span class="token operator">:</span> <span class="token maybe-class-name">KeyboardEvent</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> key<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_keyPressHandled</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_keyDownHandled</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_customKeyEventHandler</span> <span class="token operator">&#x26;&#x26;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">_customKeyEventHandler</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token spread operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>  如果沒有 return true/false，會導致 key event 會被繼續傳遞，而且會將原生事件 cancel，<br>
導致其他的 xterm key event handler (_keyDown, _keyUp, _keyPress, ...) 也會被觸發</p>
<ul>
<li>有自己的 cancel function 會在某些地方被呼叫，導致 key event 被 cancel</li>
</ul>
<p><a href="https://github.com/xtermjs/xterm.js/blob/6e351dd4ac23235c587dbf4af4cac737965cb7cd/src/browser/Terminal.ts#L1306">CodeLink</a></p>
<pre class="language-typescript"><code class="language-typescript">  <span class="token comment">// TODO: Remove cancel function and cancelEvents option</span>
  <span class="token keyword">public</span> <span class="token function">cancel</span><span class="token punctuation">(</span>ev<span class="token operator">:</span> <span class="token maybe-class-name">Event</span><span class="token punctuation">,</span> force<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">options</span><span class="token punctuation">.</span><span class="token property-access">cancelEvents</span> <span class="token operator">&#x26;&#x26;</span> <span class="token operator">!</span>force<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ev<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ev<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>