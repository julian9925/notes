{"pageProps":{"note":{"id":"9focmx7fjgd6sazrroqce2s","title":"xterm","desc":"","updated":1703715973892,"created":1703713914528,"custom":{},"fname":"Javascript.library.xterm","type":"note","vault":{"fsPath":".","selfContained":true,"name":"docs"},"contentHash":"d6dd3cc201939587dc5de8a1ca745795","links":[],"anchors":{"xterm-踩雷經驗":{"type":"header","text":"xterm 踩雷經驗","value":"xterm-踩雷經驗","line":8,"column":0,"depth":2},"在使用-xterm-的時候遇到一些問題這邊做一些紀錄":{"type":"header","text":"在使用 xterm 的時候，遇到一些問題，這邊做一些紀錄","value":"在使用-xterm-的時候遇到一些問題這邊做一些紀錄","line":9,"column":0,"depth":3}},"children":[],"parent":"6ex622vsm28garf6zzd3opn","data":{}},"body":"<h1 id=\"xterm\">xterm<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#xterm\"></a></h1>\n<h2 id=\"xterm-踩雷經驗\">xterm 踩雷經驗<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#xterm-踩雷經驗\"></a></h2>\n<h3 id=\"在使用-xterm-的時候遇到一些問題這邊做一些紀錄\">在使用 xterm 的時候，遇到一些問題，這邊做一些紀錄<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#在使用-xterm-的時候遇到一些問題這邊做一些紀錄\"></a></h3>\n<ul>\n<li><strong>當使用 attachCustomKeyEventHandler 時，<em>絕對</em> 要 return true/false</strong></li>\n</ul>\n<p>  會註冊成 <code>_customKeyEventHandler</code>，並在 <code>_keyDown, _keyUp, _keyPress</code> 中被呼叫，<br>\n並以 <code>if (this._customKeyEventHandler(ev))</code> 來判斷是否要繼續處理 key event</p>\n<p><a href=\"https://github.com/xtermjs/xterm.js/blob/6e351dd4ac23235c587dbf4af4cac737965cb7cd/src/browser/Terminal.ts#L1102\">CodeLink</a></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">protected</span> <span class=\"token function\">_keyPress</span><span class=\"token punctuation\">(</span>ev<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">KeyboardEvent</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> key<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">_keyPressHandled</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">_keyDownHandled</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">_customKeyEventHandler</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">_customKeyEventHandler</span><span class=\"token punctuation\">(</span>ev<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token spread operator\">...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>  如果沒有 return true/false，會導致 key event 會被繼續傳遞，而且會將原生事件 cancel，<br>\n導致其他的 xterm key event handler (_keyDown, _keyUp, _keyPress, ...) 也會被觸發</p>\n<ul>\n<li>有自己的 cancel function 會在某些地方被呼叫，導致 key event 被 cancel</li>\n</ul>\n<p><a href=\"https://github.com/xtermjs/xterm.js/blob/6e351dd4ac23235c587dbf4af4cac737965cb7cd/src/browser/Terminal.ts#L1306\">CodeLink</a></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\">  <span class=\"token comment\">// TODO: Remove cancel function and cancelEvents option</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span>ev<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Event</span><span class=\"token punctuation\">,</span> force<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword nil\">undefined</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">options</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">cancelEvents</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>force<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    ev<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ev<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stopPropagation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>","noteIndex":{"id":"0uuk3cixqkxat0xqh4cm542","title":"Welcome to Juian's Note","desc":"","updated":1697115192196,"created":1697115085580,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"docs"},"contentHash":"74034c389dde315161eef9d04fe474ed","links":[],"anchors":{"lookup":{"type":"header","text":"Lookup","value":"lookup","line":17,"column":0,"depth":2}},"children":["eaontip9ou4hzx32etylyya","f5344ht8bfoy774cvv27mgm","34fsdv2g735xufqoqfru1bq","aqjly8hefz09duquoig0ssv"],"parent":null,"data":{},"body":"\nThis is my personal knowledge base. It is built using [Dendron](https://wiki.dendron.so/).\n\n這會是中英文夾雜的知識庫\n\n包含\n - 一些讀書心得\n - 一些個人筆記\n - 一些 leetcode 的解題心得\n\n## Lookup\n\nThis section contains useful links to related resources.\n\n- [Getting Started Guide](https://link.dendron.so/6b25)\n- [Discord](https://link.dendron.so/6b23)\n- [Home Page](https://wiki.dendron.so/)\n- [Github](https://link.dendron.so/6b24)\n- [Developer Docs](https://docs.dendron.so/)"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"docs"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","theme":"dark","assetsPrefix":"/notes","siteUrl":"https://julian9925.github.io","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}